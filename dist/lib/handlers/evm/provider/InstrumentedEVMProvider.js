import { ethers } from "ethers";
import { metric, MetricLoggerUnit } from "@votopia/smart-order-router";
export class InstrumentedEVMProvider extends ethers.providers.StaticJsonRpcProvider {
    constructor({ url, network, name }) {
        super(url, network);
        this.name = name;
        this.metricPrefix = `RPC_${this.name}_${this.network.chainId}`;
    }
    call(transaction, blockTag) {
        return super
            .call(transaction, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_CALL_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_CALL_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_CALL_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    estimateGas(transaction) {
        return super
            .estimateGas(transaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_ESTIMATEGAS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBalance(addressOrName, blockTag) {
        return super
            .getBalance(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBALANCE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBALANCE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlock(blockHashOrBlockTag) {
        return super
            .getBlock(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockNumber() {
        return super
            .getBlockNumber()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKNUMBER_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getBlockWithTransactions(blockHashOrBlockTag) {
        return super
            .getBlockWithTransactions(blockHashOrBlockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETBLOCKWITHTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getCode(addressOrName, blockTag) {
        return super
            .getCode(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETCODE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETCODE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getGasPrice() {
        return super
            .getGasPrice()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETGASPRICE_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETGASPRICE_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getLogs(filter) {
        return super
            .getLogs(filter)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETLOGS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETLOGS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getNetwork() {
        return super
            .getNetwork()
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETNETWORK_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETNETWORK_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getStorageAt(addressOrName, position, blockTag) {
        return super
            .getStorageAt(addressOrName, position, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETSTORAGEAT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransaction(transactionHash) {
        return super
            .getTransaction(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionCount(addressOrName, blockTag) {
        return super
            .getTransactionCount(addressOrName, blockTag)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONCOUNT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    getTransactionReceipt(transactionHash) {
        return super
            .getTransactionReceipt(transactionHash)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_GETTRANSACTIONRECEIPT_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    lookupAddress(address) {
        return super
            .lookupAddress(address)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_LOOKUPADDRESS_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    resolveName(name) {
        return super
            .resolveName(name)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_RESOLVENAME_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_RESOLVENAME_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    sendTransaction(signedTransaction) {
        return super
            .sendTransaction(signedTransaction)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_SENDTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
    waitForTransaction(transactionHash, confirmations, timeout) {
        return super
            .waitForTransaction(transactionHash, confirmations, timeout)
            .then((response) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_SUCCESS`, 1, MetricLoggerUnit.Count);
            return response;
        }, (error) => {
            metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_FAILURE`, 1, MetricLoggerUnit.Count);
            throw error;
        })
            .finally(() => metric.putMetric(`${this.metricPrefix}_WAITFORTRANSACTION_REQUESTED`, 1, MetricLoggerUnit.Count));
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiSW5zdHJ1bWVudGVkRVZNUHJvdmlkZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9saWIvaGFuZGxlcnMvZXZtL3Byb3ZpZGVyL0luc3RydW1lbnRlZEVWTVByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsTUFBTSxRQUFRLENBQUM7QUFZaEMsT0FBTyxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLDZCQUE2QixDQUFDO0FBWXZFLE1BQU0sT0FBTyx1QkFBd0IsU0FBUSxNQUFNLENBQUMsU0FBUyxDQUFDLHFCQUFxQjtJQUlqRixZQUFZLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQWdDO1FBQzlELEtBQUssQ0FBQyxHQUFHLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDcEIsSUFBSSxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7UUFDakIsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUNqRSxDQUFDO0lBRVEsSUFBSSxDQUFDLFdBQTJDLEVBQUUsUUFBdUM7UUFDaEcsT0FBTyxLQUFLO2FBQ1QsSUFBSSxDQUFDLFdBQVcsRUFBRSxRQUFRLENBQUM7YUFDM0IsSUFBSSxDQUNILENBQUMsUUFBUSxFQUFFLEVBQUU7WUFDWCxNQUFNLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxDQUFDLFlBQVksZUFBZSxFQUFFLENBQUMsRUFBRSxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNqRixPQUFPLFFBQVEsQ0FBQztRQUNsQixDQUFDLEVBQ0QsQ0FBQyxLQUFLLEVBQUUsRUFBRTtZQUNSLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxJQUFJLENBQUMsWUFBWSxlQUFlLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFD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Q0FBQyxDQUFDLENBQUM7SUFDckgsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXRoZXJzIH0gZnJvbSBcImV0aGVyc1wiO1xuaW1wb3J0IHsgRGVmZXJyYWJsZSB9IGZyb20gXCJAZXRoZXJzcHJvamVjdC9wcm9wZXJ0aWVzXCI7XG5pbXBvcnQgeyBUcmFuc2FjdGlvblJlcXVlc3QgfSBmcm9tIFwiQGV0aGVyc3Byb2plY3QvcHJvdmlkZXJzXCI7XG5pbXBvcnQge1xuICBCbG9jayxcbiAgQmxvY2tUYWcsXG4gIEJsb2NrV2l0aFRyYW5zYWN0aW9ucyxcbiAgRmlsdGVyLFxuICBMb2csXG4gIFRyYW5zYWN0aW9uUmVjZWlwdCxcbiAgVHJhbnNhY3Rpb25SZXNwb25zZSxcbn0gZnJvbSBcIkBldGhlcnNwcm9qZWN0L2Fic3RyYWN0LXByb3ZpZGVyXCI7XG5pbXBvcnQgeyBtZXRyaWMsIE1ldHJpY0xvZ2dlclVuaXQgfSBmcm9tIFwiQHZvdG9waWEvc21hcnQtb3JkZXItcm91dGVyXCI7XG5pbXBvcnQgeyBCaWdOdW1iZXIsIEJpZ051bWJlcmlzaCB9IGZyb20gXCJAZXRoZXJzcHJvamVjdC9iaWdudW1iZXJcIjtcbmltcG9ydCB7IE5ldHdvcmssIE5ldHdvcmtpc2ggfSBmcm9tIFwiQGV0aGVyc3Byb2plY3QvbmV0d29ya3NcIjtcbmltcG9ydCB7IENvbm5lY3Rpb25JbmZvIH0gZnJvbSBcIkBldGhlcnNwcm9qZWN0L3dlYlwiO1xuaW1wb3J0IHsgUHJvdmlkZXJOYW1lIH0gZnJvbSBcIi4vUHJvdmlkZXJOYW1lXCI7XG5cbmV4cG9ydCB0eXBlIEluc3RydW1lbnRlZEVWTVByb3ZpZGVyUHJvcHMgPSB7XG4gIHVybD86IENvbm5lY3Rpb25JbmZvIHwgc3RyaW5nO1xuICBuZXR3b3JrPzogTmV0d29ya2lzaDtcbiAgbmFtZTogUHJvdmlkZXJOYW1lO1xufTtcblxuZXhwb3J0IGNsYXNzIEluc3RydW1lbnRlZEVWTVByb3ZpZGVyIGV4dGVuZHMgZXRoZXJzLnByb3ZpZGVycy5TdGF0aWNKc29uUnBjUHJvdmlkZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IG5hbWU6IFByb3ZpZGVyTmFtZTtcbiAgcHJpdmF0ZSByZWFkb25seSBtZXRyaWNQcmVmaXg6IHN0cmluZztcblxuICBjb25zdHJ1Y3Rvcih7IHVybCwgbmV0d29yaywgbmFtZSB9OiBJbnN0cnVtZW50ZWRFVk1Qcm92aWRlclByb3BzKSB7XG4gICAgc3VwZXIodXJsLCBuZXR3b3JrKTtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMubWV0cmljUHJlZml4ID0gYFJQQ18ke3RoaXMubmFtZX1fJHt0aGlzLm5ldHdvcmsuY2hhaW5JZH1gO1xuICB9XG5cbiAgb3ZlcnJpZGUgY2FsbCh0cmFuc2FjdGlvbjogRGVmZXJyYWJsZTxUcmFuc2FjdGlvblJlcXVlc3Q+LCBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmNhbGwodHJhbnNhY3Rpb24sIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fQ0FMTF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0NBTExfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZXN0aW1hdGVHYXModHJhbnNhY3Rpb246IERlZmVycmFibGU8VHJhbnNhY3Rpb25SZXF1ZXN0Pik6IFByb21pc2U8QmlnTnVtYmVyPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZXN0aW1hdGVHYXModHJhbnNhY3Rpb24pXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fRVNUSU1BVEVHQVNfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fRVNUSU1BVEVHQVNfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9FU1RJTUFURUdBU19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRCYWxhbmNlKFxuICAgIGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPixcbiAgICBibG9ja1RhZz86IEJsb2NrVGFnIHwgUHJvbWlzZTxCbG9ja1RhZz5cbiAgKTogUHJvbWlzZTxCaWdOdW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRCYWxhbmNlKGFkZHJlc3NPck5hbWUsIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJBTEFOQ0VfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkFMQU5DRV9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJBTEFOQ0VfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0QmxvY2soYmxvY2tIYXNoT3JCbG9ja1RhZzogQmxvY2tUYWcgfCBzdHJpbmcgfCBQcm9taXNlPEJsb2NrVGFnIHwgc3RyaW5nPik6IFByb21pc2U8QmxvY2s+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRCbG9jayhibG9ja0hhc2hPckJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0QmxvY2tOdW1iZXIoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRCbG9ja051bWJlcigpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tOVU1CRVJfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tOVU1CRVJfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRCTE9DS05VTUJFUl9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRCbG9ja1dpdGhUcmFuc2FjdGlvbnMoXG4gICAgYmxvY2tIYXNoT3JCbG9ja1RhZzogQmxvY2tUYWcgfCBzdHJpbmcgfCBQcm9taXNlPEJsb2NrVGFnIHwgc3RyaW5nPlxuICApOiBQcm9taXNlPEJsb2NrV2l0aFRyYW5zYWN0aW9ucz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldEJsb2NrV2l0aFRyYW5zYWN0aW9ucyhibG9ja0hhc2hPckJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLV0lUSFRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVEJMT0NLV0lUSFRSQU5TQUNUSU9OX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT5cbiAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQkxPQ0tXSVRIVFJBTlNBQ1RJT05fUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudClcbiAgICAgICk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRDb2RlKGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPiwgYmxvY2tUYWc/OiBCbG9ja1RhZyB8IFByb21pc2U8QmxvY2tUYWc+KTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRDb2RlKGFkZHJlc3NPck5hbWUsIGJsb2NrVGFnKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVENPREVfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUQ09ERV9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVENPREVfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0R2FzUHJpY2UoKTogUHJvbWlzZTxCaWdOdW1iZXI+IHtcbiAgICByZXR1cm4gc3VwZXJcbiAgICAgIC5nZXRHYXNQcmljZSgpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUR0FTUFJJQ0VfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUR0FTUFJJQ0VfRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRHQVNQUklDRV9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRMb2dzKGZpbHRlcjogRmlsdGVyKTogUHJvbWlzZTxBcnJheTxMb2c+PiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuZ2V0TG9ncyhmaWx0ZXIpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTE9HU19TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRMT0dTX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTE9HU19SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXROZXR3b3JrKCk6IFByb21pc2U8TmV0d29yaz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldE5ldHdvcmsoKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVE5FVFdPUktfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUTkVUV09SS19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVE5FVFdPUktfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgZ2V0U3RvcmFnZUF0KFxuICAgIGFkZHJlc3NPck5hbWU6IHN0cmluZyB8IFByb21pc2U8c3RyaW5nPixcbiAgICBwb3NpdGlvbjogQmlnTnVtYmVyaXNoIHwgUHJvbWlzZTxCaWdOdW1iZXJpc2g+LFxuICAgIGJsb2NrVGFnPzogQmxvY2tUYWcgfCBQcm9taXNlPEJsb2NrVGFnPlxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFN0b3JhZ2VBdChhZGRyZXNzT3JOYW1lLCBwb3NpdGlvbiwgYmxvY2tUYWcpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUU1RPUkFHRUFUX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFNUT1JBR0VBVF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFNUT1JBR0VBVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkhhc2g6IHN0cmluZyk6IFByb21pc2U8VHJhbnNhY3Rpb25SZXNwb25zZT4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFRyYW5zYWN0aW9uKHRyYW5zYWN0aW9uSGFzaClcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTl9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGdldFRyYW5zYWN0aW9uQ291bnQoXG4gICAgYWRkcmVzc09yTmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+LFxuICAgIGJsb2NrVGFnPzogQmxvY2tUYWcgfCBQcm9taXNlPEJsb2NrVGFnPlxuICApOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFRyYW5zYWN0aW9uQ291bnQoYWRkcmVzc09yTmFtZSwgYmxvY2tUYWcpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05DT1VOVF9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9HRVRUUkFOU0FDVElPTkNPVU5UX0ZBSUxVUkVgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgICAgKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05DT1VOVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cblxuICBvdmVycmlkZSBnZXRUcmFuc2FjdGlvblJlY2VpcHQodHJhbnNhY3Rpb25IYXNoOiBzdHJpbmcpOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVjZWlwdD4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLmdldFRyYW5zYWN0aW9uUmVjZWlwdCh0cmFuc2FjdGlvbkhhc2gpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fR0VUVFJBTlNBQ1RJT05SRUNFSVBUX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OUkVDRUlQVF9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+XG4gICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0dFVFRSQU5TQUNUSU9OUkVDRUlQVF9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KVxuICAgICAgKTtcbiAgfVxuXG4gIG92ZXJyaWRlIGxvb2t1cEFkZHJlc3MoYWRkcmVzczogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAubG9va3VwQWRkcmVzcyhhZGRyZXNzKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0xPT0tVUEFERFJFU1NfU1VDQ0VTU2AsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fTE9PS1VQQUREUkVTU19GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X0xPT0tVUEFERFJFU1NfUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgcmVzb2x2ZU5hbWUobmFtZTogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+KTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAucmVzb2x2ZU5hbWUobmFtZSlcbiAgICAgIC50aGVuKFxuICAgICAgICAocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9SRVNPTFZFTkFNRV9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9SRVNPTFZFTkFNRV9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1JFU09MVkVOQU1FX1JFUVVFU1RFRGAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpKTtcbiAgfVxuXG4gIG92ZXJyaWRlIHNlbmRUcmFuc2FjdGlvbihzaWduZWRUcmFuc2FjdGlvbjogc3RyaW5nIHwgUHJvbWlzZTxzdHJpbmc+KTogUHJvbWlzZTxUcmFuc2FjdGlvblJlc3BvbnNlPiB7XG4gICAgcmV0dXJuIHN1cGVyXG4gICAgICAuc2VuZFRyYW5zYWN0aW9uKHNpZ25lZFRyYW5zYWN0aW9uKVxuICAgICAgLnRoZW4oXG4gICAgICAgIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1NFTkRUUkFOU0FDVElPTl9TVUNDRVNTYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICB9LFxuICAgICAgICAoZXJyb3IpID0+IHtcbiAgICAgICAgICBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9TRU5EVFJBTlNBQ1RJT05fRkFJTFVSRWAsIDEsIE1ldHJpY0xvZ2dlclVuaXQuQ291bnQpO1xuICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICB9XG4gICAgICApXG4gICAgICAuZmluYWxseSgoKSA9PiBtZXRyaWMucHV0TWV0cmljKGAke3RoaXMubWV0cmljUHJlZml4fV9TRU5EVFJBTlNBQ1RJT05fUkVRVUVTVEVEYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCkpO1xuICB9XG5cbiAgb3ZlcnJpZGUgd2FpdEZvclRyYW5zYWN0aW9uKFxuICAgIHRyYW5zYWN0aW9uSGFzaDogc3RyaW5nLFxuICAgIGNvbmZpcm1hdGlvbnM/OiBudW1iZXIsXG4gICAgdGltZW91dD86IG51bWJlclxuICApOiBQcm9taXNlPFRyYW5zYWN0aW9uUmVjZWlwdD4ge1xuICAgIHJldHVybiBzdXBlclxuICAgICAgLndhaXRGb3JUcmFuc2FjdGlvbih0cmFuc2FjdGlvbkhhc2gsIGNvbmZpcm1hdGlvbnMsIHRpbWVvdXQpXG4gICAgICAudGhlbihcbiAgICAgICAgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgbWV0cmljLnB1dE1ldHJpYyhgJHt0aGlzLm1ldHJpY1ByZWZpeH1fV0FJVEZPUlRSQU5TQUNUSU9OX1NVQ0NFU1NgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KTtcbiAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1dBSVRGT1JUUkFOU0FDVElPTl9GQUlMVVJFYCwgMSwgTWV0cmljTG9nZ2VyVW5pdC5Db3VudCk7XG4gICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICAgIClcbiAgICAgIC5maW5hbGx5KCgpID0+IG1ldHJpYy5wdXRNZXRyaWMoYCR7dGhpcy5tZXRyaWNQcmVmaXh9X1dBSVRGT1JUUkFOU0FDVElPTl9SRVFVRVNURURgLCAxLCBNZXRyaWNMb2dnZXJVbml0LkNvdW50KSk7XG4gIH1cbn1cbiJdfQ==